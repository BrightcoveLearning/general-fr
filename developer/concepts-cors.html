---
title: 'Comprendre la SCRO'
description: 'Dans cette rubrique, vous découvrirez CORS et les contraintes intégrées au Web concernant le référencement cross-origin d'actifs tels que des vidéos, des images et des scripts.'
parent: Developers
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Overview">Vue d'ensemble</h2>
    <p>Le partage de ressources d'origine croisée (CORS) est un mécanisme qui permet à une page Web d'effectuer des requêtes vers un autre domaine que celui à partir duquel la page a été diffusée. Normalement, les requêtes inter-domaines seraient autrement interdites par les navigateurs Web. CORS définit une façon dont les domaines peuvent interagir pour déterminer s'il faut autoriser ou non une demande d'origine croisée.</p>
    <aside class="bcls-aside bcls-aside--information">Notez que CORS est <strong>ne pas</strong> activé par ou lié à crossdomain.xml, qui est un mécanisme d'activation des requêtes interdomaines pour les applications Flash.</aside>
  </section>
  <section class="bcls-section">
    <h2 id="corsandbc">CORS et Brightcove</h2>
    <p>Il y a trois cas où CORS doit être utilisé avec les services/produits Brightcove :</p>
    <ol>
      <li><strong>Légendes des vidéos</strong>: Le fichier contenant les sous-titres d'une vidéo peut être stocké sur un domaine autre que BrightCove. Étant donné que la vidéo elle-même sera diffusée à partir d'un domaine Brightcove, cela entraînera des problèmes interdomaines.</li>
      <li><strong>Brightcove Player et HLS</strong>: Les <span class="video-cloud-only" translate="No">Joueur de Brightcove </span>Le plug-in HLS utilise des requêtes AJAX pour récupérer le manifeste et les segments individuels de la vidéo HLS. Étant donné que ces ressources HLS peuvent être stockées sur n'importe quel domaine accessible à Internet, il est probable que ces ressources seront fournies à partir d'un serveur différent (généralement un domaine CDN) que du domaine Brightcove qui a servi le lecteur. Cela entraînera à nouveau des problèmes interdomaines.</li>
      <li><strong>Images fixes et miniatures vidéo</strong> : pour <a href="https://studio.support.brightcove.com/media/capturing-poster-and-thumbnail-images.html">capturer des images vidéo fixes et miniatures dans Studio</a>, le rendu vidéo doit être servi avec des en-têtes CORS (qui doivent être activés sur la plupart des images de Brightcove héberger des CDN par défaut) ; si vous possédez un CDN personnalisé ou un CDN que nous n'avons pas encore mis à jour, la capture d'image ne fonctionnera pas</li>
    </ol>
  </section>
  <section class="bcls-section">
    <h2 id="solution">Solutions</h2>
    <p>La solution utilisée par Brightcove consiste à configurer un <code translate="No">Access-Control-Allow-Origin</code> en-tête dans le fichier de configuration du serveur d'origine CDN. Il est important de noter que puisque différents partenaires CDN utilisent des solutions serveur différentes pour diffuser leur contenu, les informations d'en-tête ci-dessous sont proposées à titre d'exemple, et non sous forme d'extrait de code de dépôt.</p>
    <p>Brightcove a réussi avec la directive d'en-tête suivante pour les propriétés du serveur CDN interne :</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;FilesMatch ".(vtt|xml)$"&gt;
              Header set Access-Control-Allow-Headers: X-Requested-With
              Header add Access-Control-Allow-Origin: http://admin.brightcove.com
          &lt;/FilesMatch&gt;</code></pre>
    <p>Voici de brèves explications de la directive :</p>
    <ul>
      <li><code translate="No">&lt;FilesMatch ".(vtt|xml)$"&gt;</code>: Ce conditionnel définit l' <code translate="No">Access-Control-Allow-Origin</code> en-tête uniquement sur les fichiers vtt ou xml. Les tests ont confirmé que cet en-tête n'est pas envoyé avec des images ou d'autres contenus délivrés par http.</li>
      <li><code translate="No">Header set Access-Control-Allow-Headers: X-Requested-With</code>: Cet en-tête est requis pour que l' <code translate="No">Access-Control-Allow-Origin</code> en-tête fonctionne, car la requête que le lecteur fait est XMLHttpRequest.</li>
      <li><code translate="No">Header add Access-Control-Allow-Origin: http://admin.brightcove.com</code>: Il s'agit de l'en-tête de contrôle d'accès lui-même pour autoriser le contenu du domaine indiqué.</li>
    </ul>
    <h3>Activation de CORS sur Apache</h3>
    <p>Vous pouvez définir un en-tête dans la configuration des serveurs Apache pour activer CORS. Placez les éléments suivants dans le <code translate="No">.conf</code> fichier approprié :</p>
    <pre class="line-numbers">
<code class="language-bash" translate="No">Header set Access-Control-Allow-Origin "*"</code></pre>
    <p>Dans l'exemple ci-dessus, les astérisques agissent comme un joker et permet l'accès à tous les domaines. Le caractère générique peut également être remplacé par <strong>un</strong> domaine spécifique. Cela ne fonctionnera généralement pas pour les joueurs de Brightcove, car dans de nombreux cas, les actifs résident sur plusieurs domaines. Vous pouvez implémenter d'autres solutions pour limiter l'accès à une liste blanche spécifique des domaines acceptables.</p>
    <h3>BYO CDN</h3>
    <p>Si vous êtes client avec un CDN BYO et que vous rencontrez des problèmes interdomaines, contactez votre CDN pour obtenir de l'aide pour configurer CORS pour votre compte. Voici les paramètres que nous recommandons :</p>
    <ul>
      <li>Access-Control-Allow-En-têtes : X-Demande-Avec</li>
      <li>Access-Control-Allow-Origine : *</li>
      <li>formats de fichiers : m3u8 m3u ts xml dfxp vtt mpd m4f mp4 jpg png</li>
    </ul>
    <h3>Exigences d'autorisation de jeton</h3>
    <p>Dans le cas où l'autorisation de jeton est requise, des modifications doivent être apportées à la solution ci-dessus. Dans le cas de l'autorisation de jeton, le modèle de sécurité CORS n'autorise expressément l'utilisation du <code translate="No">*</code> caractère comme valeur pour l'en-tête de <code translate="No">Access-Control-Allow-Origin</code> réponse. En outre, l'en-tête de <code translate="No">Access-Control-Allow-Credentials</code> réponse est obligatoire et doit être défini sur true.</p>
    <p>Une directive d'en-tête mise à jour pour l'autorisation de jeton est la suivante :</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;FilesMatch ".(m3u8 | m3u | ts)$"&gt;
        # with AJAX withCredentials=true (cookies sent, SSL allowed...)
        SetEnvIfNoCase ORIGIN (.*) ORIGIN=$1
        Header set Access-Control-Allow-Origin "%{ORIGIN}e"
        Header set Access-Control-Allow-Credentials "true"
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} OPTIONS
        RewriteRule ^(.*)$ $1 [R=200,L,E=HTTP_ORIGIN:%{HTTP:ORIGIN}]
  &lt;/FilesMatch&gt;</code></pre>
    <p>Les points suivants détaillent les différences par rapport à la solution antérieure :</p>
    <ul>
      <li>La directive interroge la demande entrante pour détecter la présence d'un en-tête Origin, et si cet en-tête est présent (c'est généralement le cas), définit sa valeur sur une variable appelée <code translate="No">ORIGIN</code>: <code translate="No">SetEnvIfNoCase ORIGIN (.*) ORIGIN=$1</code></li>
      <li>Les <code translate="No">Access-Control-Allow-Origin</code> la valeur de l'en-tête de réponse est définie sur la valeur du <code translate="No">ORIGIN</code> variable qui vient d'être créée : <code translate="No">Header set Access-Control-Allow-Origin "%{ORIGIN}e"</code> <aside class="bcls-aside bcls-aside--information">Les <code translate="No">e</code> est requis, pour indiquer qu'il s'agit d'une variable d'environnement.</aside>
      </li>
      <li>L' <code translate="No">Access-Control-Allow-Credentials</code> en-tête doit être défini sur <code translate="No">true</code>: <code translate="No">Header set Access-Control-Allow-Credentials "true"</code></li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="hls">HLS et CORS</h2>
    <p>Dans certains environnements (comme Amazon S3), vous pouvez spécifier une configuration CORS pour HLS. Ce qui suit configure CORS pour autoriser la lecture HLS.</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;CORSConfiguration&gt;
      &lt;CORSRule&gt;
      &lt;AllowedOrigin&gt;*&lt;/AllowedOrigin&gt;
      &lt;AllowedMethod&gt;GET&lt;/AllowedMethod&gt;
      &lt;/CORSRule&gt;
&lt;/CORSConfiguration&gt;</code></pre>
    <p>Pour plus d'informations spécifiques à Amazon S3, consultez <a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/cors.html#how-do-i-enable-cors">Activation du partage de ressources d'origine croisée</a>.</p>
    <p>Bien que tangentiel à CORS, le navigateur client doit accepter tous les cookies de session pour que la diffusion de contenu HLS autorisée par jeton fonctionne correctement. Bien que certains navigateurs clients, tels que Google Chrome et Mozilla Firefox, acceptent les cookies de session par défaut, d'autres navigateurs, comme Internet Explorer, ne le font pas, cette option doit être activée par l'utilisateur.</p>
  </section>
</article>